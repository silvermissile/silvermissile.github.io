[toc]
--------------------------------

# 白天、晚上配置切换
## 测试
``` sh
#today
ansible node54 -m copy -a "src=/home/ubuntu/data/xfapp/presto_config/worker/jvm_worker_day.config   dest=/home/ubuntu/data/presto-server-0.219/etc/jvm.config" ;
ansible node54 -m copy -a "src=/home/ubuntu/data/xfapp/presto_config/worker/config_worker_day.properties  dest=/home/ubuntu/data/presto-server-0.219/etc/config.properties" ;
#restart
/home/ubuntu/data/presto-server-0.219/bin/launcher restart;
curl -u admin:password_test  --header "Content-Type: application/json"    --request POST    http://ip-172-31-17-54:7180/api/v19/clusters/TestCdh/services/impala/commands/start ;

#tonight
ansible node54 -m copy -a "src=/home/ubuntu/data/xfapp/presto_config/worker/jvm_worker_night.config   dest=/home/ubuntu/data/presto-server-0.219/etc/jvm.config" ;
ansible node54 -m copy -a "src=/home/ubuntu/data/xfapp/presto_config/worker/config_worker_night.properties  dest=/home/ubuntu/data/presto-server-0.219/etc/config.properties" ;
#restart
/home/ubuntu/data/presto-server-0.219/bin/launcher restart;


curl -u admin:password_test  --header "Content-Type: application/json"    --request POST    http://ip-172-31-17-54:7180/api/v19/clusters/TestCdh/services/impala/commands/stop ;

```


## 生产
### 白天
``` sh
0 23 * * *  /home/ubuntu/data/xfapp/presto_config/today.sh >> /tmp/preostoto_day.log
#today
ansible prestoworker  -m copy -a "src=/home/ubuntu/data/xfapp/presto_config/worker/jvm_worker_day.config   dest=/home/ubuntu/data/presto-server-0.219/etc/jvm.config" ;
ansible prestoworker  -m copy -a "src=/home/ubuntu/data/xfapp/presto_config/worker/config_worker_day.properties  dest=/home/ubuntu/data/presto-server-0.219/etc/config.properties" ;
#restart
/home/ubuntu/data/xfapp/presto_config/presto_cluster219/presto_restart_cluster.sh;

curl -u admin:password_pro  --header "Content-Type: application/json"    --request POST    http://172.31.17.250:7180/api/v19/clusters/pro/services/impala/commands/start ;
```
ftp://10.0.11.1:21

### 晚上

``` sh
0 14 * * *  /home/ubuntu/data/xfapp/presto_config/tonight.sh >> /tmp/preostoto_night.log


#tonight
ansible prestoworker  -m copy -a "src=/home/ubuntu/data/xfapp/presto_config/worker/jvm_worker_night.config   dest=/home/ubuntu/data/presto-server-0.219/etc/jvm.config" ;
ansible prestoworker  -m copy -a "src=/home/ubuntu/data/xfapp/presto_config/worker/config_worker_night.properties  dest=/home/ubuntu/data/presto-server-0.219/etc/config.properties" ;
#restart
/home/ubuntu/data/xfapp/presto_config/presto_cluster219/presto_restart_cluster.sh;

curl -u admin:password_pro  --header "Content-Type: application/json"    --request POST    http://172.31.17.250:7180/api/v19/clusters/pro/services/impala/commands/stop ;
```


# resouce_group配置
并发查询数、等待查询队列长度、资源比例等再使用中调整
``` sh
ansible prestoall -m copy -a "src=/home/ubuntu/data/xfapp/presto_config/resource_groups.json   dest=/home/ubuntu/data/presto-server-0.219/etc/resource_groups.json" ;
ansible prestoall -m copy -a "src=/home/ubuntu/data/xfapp/presto_config/resource-groups.properties  dest=/home/ubuntu/data/presto-server-0.219/etc/resource-groups.properties"
```
##  根据用户分组
``` mermaid
graph LR

root-->admin

root(root)
root-->A
A(global_root) --> B(adhoc)

B --> some_user(some_user)
B --> other_user(............)

admin(admin)-->hive(hive/zhaoxf/...)
bi-->u_backend_bi(backend_bi)
bi--> backend_analysis(backend_analysis)
A-->bi(bi)

classDef user fill:#f9f,stroke:#333,stroke-width:4px;
class some_user,other_user,backend_analysis,hive,u_backend_bi user;
```


开启这个服务，在家里没有
买个miniPC当服务器。
